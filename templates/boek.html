{% extends "base.html" %}

{% block title %}{{ boek.titel }} - Schoolbibliotheek{% endblock title %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <!-- Book Cover and Status -->
        <div class="col-lg-4 mb-4 text-center">
            <div class="position-relative d-inline-block">
                <img src="{{ boek.cover_path }}" alt="Boek Cover" class="img-fluid rounded shadow" style="max-height: 400px; object-fit: contain;">
                {% if boek.beschikbaar_aantal > 0 and not boek.status %}
                    <span class="badge bg-success position-absolute top-0 start-0 m-2 fs-6">Beschikbaar</span>
                {% elif boek.status %}
                    <span class="badge bg-secondary position-absolute top-0 start-0 m-2 fs-6">Afwezig</span>
                {% else %}
                    <span class="badge bg-danger position-absolute top-0 start-0 m-2 fs-6">Uitgeleend</span>
                {% endif %}
            </div>
            <div class="mt-3">
                <a href="{{ url_for('reserveer_boek', ISBN=boek.ISBN) }}"
                   class="btn btn-primary btn-lg w-100 {% if boek.beschikbaar_aantal == 0 or boek.status %}disabled{% endif %}">
                    Reserveer dit boek
                </a>
                {% if boek.beschikbaar_aantal == 0 %}
                    <div class="text-danger mt-2">Geen exemplaren beschikbaar</div>
                {% elif boek.status %}
                    <div class="text-warning mt-2">Boek is afwezig en kan niet uitgeleend worden</div>
                {% endif %}
            </div>
        </div>

        <!-- Book Info -->
        <div class="col-lg-6 mb-4">
            <h2 class="fw-bold text-primary">{{ boek.titel }}</h2>
            <hr>
            <p><strong>Auteur(s):</strong>
                {% if boek.auteurs %}
                    {% for auteur in boek.auteurs %}
                        {{ auteur.naam }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    <span class="text-danger">Onbekend</span>
                {% endif %}
            </p>
            <p><strong>Genre(s):</strong>
                {% if boek.genres %}
                    {% for genre in boek.genres %}
                        {{ genre.naam }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    <span class="text-danger">Onbekend</span>
                {% endif %}
            </p>
            <p><strong>Thema(s):</strong>
                {% if boek.themas %}
                    {% for thema in boek.themas %}
                        {{ thema.naam }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    <span class="text-danger">Onbekend</span>
                {% endif %}
            </p>
            <p><strong>Locatie:</strong> {{ boek.locatie.naam if boek.locatie else 'Onbekend' }}</p>
            <p><strong>ISBN:</strong> {{ boek.ISBN }}</p>
            <p><strong>Beschrijving:</strong><br>
                {{ boek.beschrijving or 'Geen beschrijving beschikbaar.' }}
            </p>
            <p><strong>Beschikbare exemplaren:</strong> {{ boek.beschikbaar_aantal }}</p>
        </div>
    </div>

    <!-- Reservation Calendar -->
    <div class="row justify-content-center mt-4">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-calendar-event"></i> Reserveringen kalender
                </div>
                <div class="card-body">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- FullCalendar CSS & JS (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'nl',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: {{ reserved_dates|tojson|safe }},
            eventColor: '#dc3545',
            eventTextColor: '#ffffff',
            height: 'auto'
        });
        calendar.render();
    });
</script>
{% endblock body %}